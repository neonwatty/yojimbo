<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CC Orchestrator - CYBERPUNK</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Fira Code', 'monospace'],
            heading: ['Orbitron', 'sans-serif'],
            mono: ['Fira Code', 'monospace'],
          },
          colors: {
            cyber: {
              bg: '#0d0d0d',
              'bg-light': '#1a1a1a',
              'bg-lighter': '#262626',
              pink: '#ff00ff',
              'pink-bright': '#ff33ff',
              'pink-dim': '#cc00cc',
              cyan: '#00ffff',
              'cyan-bright': '#33ffff',
              'cyan-dim': '#00cccc',
              purple: '#9d4edd',
              'purple-bright': '#b565f5',
              'purple-dim': '#7b3eb8',
            },
            // State colors - intense neon versions
            state: {
              working: '#00ffff',      // Electric cyan
              awaiting: '#ffff00',     // Bright yellow
              idle: '#808080',         // Gray
              error: '#ff0055',        // Hot pink-red
            }
          }
        }
      }
    }
  </script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background: #0d0d0d;
      font-family: 'Fira Code', monospace;
      color: #00ffff;
      overflow: hidden;
    }

    /* Scanline overlay effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 255, 255, 0.03) 0px,
        rgba(0, 255, 255, 0.03) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 9999;
      animation: scanlines 8s linear infinite;
    }

    @keyframes scanlines {
      0% { transform: translateY(0); }
      100% { transform: translateY(10px); }
    }

    /* Glitch text animation */
    @keyframes glitch {
      0%, 100% {
        transform: translate(0);
        text-shadow:
          0 0 10px #ff00ff,
          0 0 20px #ff00ff,
          0 0 30px #ff00ff;
      }
      25% {
        transform: translate(-2px, 2px);
        text-shadow:
          2px 0 #00ffff,
          -2px 0 #ff00ff,
          0 0 30px #ff00ff;
      }
      50% {
        transform: translate(2px, -2px);
        text-shadow:
          -2px 0 #00ffff,
          2px 0 #ff00ff,
          0 0 30px #ff00ff;
      }
      75% {
        transform: translate(-2px, -2px);
        text-shadow:
          2px 2px #00ffff,
          -2px -2px #ff00ff,
          0 0 30px #ff00ff;
      }
    }

    .glitch-hover:hover {
      animation: glitch 0.3s infinite;
    }

    /* Neon glow text */
    .neon-text {
      text-shadow:
        0 0 5px currentColor,
        0 0 10px currentColor,
        0 0 20px currentColor,
        0 0 40px currentColor;
    }

    .neon-text-pink {
      color: #ff00ff;
      text-shadow:
        0 0 5px #ff00ff,
        0 0 10px #ff00ff,
        0 0 20px #ff00ff,
        0 0 40px #ff00ff;
    }

    .neon-text-cyan {
      color: #00ffff;
      text-shadow:
        0 0 5px #00ffff,
        0 0 10px #00ffff,
        0 0 20px #00ffff,
        0 0 40px #00ffff;
    }

    /* Neon box glow */
    .neon-box-pink {
      box-shadow:
        0 0 5px #ff00ff,
        0 0 10px #ff00ff,
        0 0 20px #ff00ff,
        0 0 40px rgba(255, 0, 255, 0.5),
        inset 0 0 10px rgba(255, 0, 255, 0.2);
    }

    .neon-box-cyan {
      box-shadow:
        0 0 5px #00ffff,
        0 0 10px #00ffff,
        0 0 20px #00ffff,
        0 0 40px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .neon-box-purple {
      box-shadow:
        0 0 5px #9d4edd,
        0 0 10px #9d4edd,
        0 0 20px #9d4edd,
        0 0 40px rgba(157, 78, 221, 0.5),
        inset 0 0 10px rgba(157, 78, 221, 0.2);
    }

    /* Gradient border using background-clip */
    .gradient-border {
      position: relative;
      background: linear-gradient(45deg, #ff00ff, #00ffff, #9d4edd, #ff00ff);
      background-size: 300% 300%;
      animation: gradient-shift 3s ease infinite;
      padding: 2px;
      clip-path: polygon(
        0 8px, 8px 0, calc(100% - 8px) 0, 100% 8px,
        100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px)
      );
    }

    .gradient-border > * {
      background: #1a1a1a;
      clip-path: polygon(
        0 8px, 8px 0, calc(100% - 8px) 0, 100% 8px,
        100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px)
      );
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    /* Clipped corners */
    .clip-corner {
      clip-path: polygon(
        0 8px, 8px 0, calc(100% - 8px) 0, 100% 8px,
        100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px)
      );
    }

    /* Small clip for small elements */
    .clip-corner-sm {
      clip-path: polygon(
        0 4px, 4px 0, calc(100% - 4px) 0, 100% 4px,
        100% calc(100% - 4px), calc(100% - 4px) 100%, 4px 100%, 0 calc(100% - 4px)
      );
    }

    /* Skewed elements */
    .skew-left {
      transform: skewX(-2deg);
    }

    .skew-right {
      transform: skewX(2deg);
    }

    /* Pulsing neon ring for status */
    @keyframes pulse-ring {
      0% {
        box-shadow:
          0 0 0 0 currentColor,
          0 0 5px currentColor,
          0 0 10px currentColor;
      }
      50% {
        box-shadow:
          0 0 0 8px transparent,
          0 0 15px currentColor,
          0 0 25px currentColor;
      }
      100% {
        box-shadow:
          0 0 0 0 transparent,
          0 0 5px currentColor,
          0 0 10px currentColor;
      }
    }

    .pulse-neon {
      animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Data stream background */
    @keyframes data-stream {
      0% { background-position: 0 0; }
      100% { background-position: 0 100px; }
    }

    .data-stream {
      background-image:
        linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px);
      background-size: 100% 20px;
      animation: data-stream 2s linear infinite;
    }

    /* Fast animations with jitter */
    @keyframes jitter {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(-1px, 1px); }
      50% { transform: translate(1px, -1px); }
      75% { transform: translate(-1px, -1px); }
    }

    .jitter-hover:hover {
      animation: jitter 0.2s infinite;
    }

    /* Enhanced entrance animation with glitch */
    @keyframes cyber-reveal {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
        filter: blur(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
      }
    }

    .animate-in {
      animation: cyber-reveal 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      opacity: 0;
    }

    .delay-1 { animation-delay: 0.05s; }
    .delay-2 { animation-delay: 0.1s; }
    .delay-3 { animation-delay: 0.15s; }
    .delay-4 { animation-delay: 0.2s; }
    .delay-5 { animation-delay: 0.25s; }

    /* Working state pulse - faster */
    @keyframes pulse-working {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    .pulse-working {
      animation: pulse-working 1s ease-in-out infinite;
    }

    /* Smooth reorder transition */
    .instance-item {
      transition: transform 0.2s ease-out, opacity 0.2s ease-out;
    }

    /* Close animation with glitch */
    @keyframes cyber-slideout {
      from {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateX(-12px) scale(0.95);
        filter: brightness(2);
      }
    }
    .animate-out {
      animation: cyber-slideout 0.2s ease-in forwards;
      pointer-events: none;
    }

    /* Focus mode animations - faster */
    @keyframes cyber-focusExpand {
      from { opacity: 0.8; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .focus-expand {
      animation: cyber-focusExpand 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    .focus-transition {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Terminal styling */
    .terminal-text {
      font-family: 'Fira Code', monospace;
      font-size: 13px;
      line-height: 1.6;
      letter-spacing: 0.5px;
    }

    /* Cyber gradient backgrounds */
    .bg-cyber-gradient {
      background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
    }

    /* Atmospheric gradient mesh - cyberpunk style */
    .bg-cyber-atmosphere {
      background:
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(255, 0, 255, 0.2) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 100% 100%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
        radial-gradient(ellipse 70% 60% at 0% 50%, rgba(157, 78, 221, 0.1) 0%, transparent 50%),
        linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
    }

    /* Active state glow - intense */
    .active-glow {
      box-shadow:
        0 0 5px #ff00ff,
        0 0 10px #ff00ff,
        0 0 20px #ff00ff,
        0 0 30px rgba(255, 0, 255, 0.6);
      border: 2px solid #ff00ff;
    }

    /* Status glow effects - bright */
    @keyframes working-pulse-cyber {
      0%, 100% {
        box-shadow:
          0 0 5px #00ffff,
          0 0 10px #00ffff,
          0 0 20px rgba(0, 255, 255, 0.8);
      }
      50% {
        box-shadow:
          0 0 10px #00ffff,
          0 0 20px #00ffff,
          0 0 40px rgba(0, 255, 255, 1);
      }
    }

    .status-working-glow {
      animation: working-pulse-cyber 1s ease-in-out infinite;
    }

    .status-error-glow {
      box-shadow:
        0 0 5px #ff0055,
        0 0 10px #ff0055,
        0 0 20px #ff0055,
        0 0 30px rgba(255, 0, 85, 0.8);
    }

    /* Scrollbar styling - cyberpunk */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    ::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-left: 1px solid #ff00ff;
    }
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ff00ff, #00ffff);
      border-radius: 0;
      box-shadow: 0 0 5px #ff00ff;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #ff33ff, #33ffff);
      box-shadow: 0 0 10px #ff00ff;
    }

    /* Hover effects with jitter */
    .hover-lift {
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .hover-lift:hover {
      transform: translateY(-3px);
    }

    .press-effect:active {
      transform: scale(0.95);
    }

    .hover-scale {
      transition: transform 0.1s ease;
    }
    .hover-scale:hover {
      transform: scale(1.1);
    }

    .hover-highlight {
      transition: all 0.15s ease;
    }
    .hover-highlight:hover {
      transform: translateX(6px);
    }

    /* Card elevated with cyber aesthetic */
    .card-cyber {
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid #ff00ff;
    }

    /* Terminal glow - bottom cyber effect */
    .terminal-glow {
      position: relative;
      overflow: visible;
    }
    .terminal-glow::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 120px;
      background: linear-gradient(to top, rgba(0, 255, 255, 0.15) 0%, transparent 100%);
      pointer-events: none;
      z-index: 1;
    }
  </style>
</head>
<body class="bg-cyber-bg text-cyber-cyan min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Mock data for instances
    const mockInstances = [
      {
        id: '1',
        name: 'auth-refactor',
        status: 'working',
        pinned: true,
        workingDir: '~/projects/webapp/src/auth',
        lastOutput: [
          '$ claude',
          '> Refactoring authentication middleware...',
          '> Reading src/middleware/auth.ts',
          '> Analyzing token validation logic...',
        ]
      },
      {
        id: '2',
        name: 'api-tests',
        status: 'awaiting',
        pinned: false,
        workingDir: '~/projects/webapp/tests',
        lastOutput: [
          '$ claude',
          '> I\'ve created 12 new test cases for the API endpoints.',
          '> Would you like me to run them now?',
          'â–ˆ',
        ]
      },
      {
        id: '3',
        name: 'docs-update',
        status: 'idle',
        pinned: false,
        workingDir: '~/projects/webapp/docs',
        lastOutput: [
          '$ claude',
          '> Documentation updated successfully.',
          '> ',
          '$ ',
        ]
      },
      {
        id: '4',
        name: 'bug-fix-cart',
        status: 'error',
        pinned: true,
        workingDir: '~/projects/webapp/src/cart',
        lastOutput: [
          '$ claude',
          '> Attempting to fix cart calculation...',
          '> Error: Cannot read property \'price\' of undefined',
          '> Stack trace: ...',
        ]
      },
      {
        id: '5',
        name: 'feature-search',
        status: 'working',
        pinned: false,
        workingDir: '~/projects/webapp/src/search',
        lastOutput: [
          '$ claude',
          '> Implementing fuzzy search algorithm...',
          '> Writing src/search/fuzzy.ts',
          '> â–ˆ',
        ]
      },
    ];

    // Mock data for session history
    const mockSessions = [
      {
        id: 'session-1',
        name: 'auth-refactor',
        workingDir: '~/projects/webapp',
        timestamp: new Date(),
        messageCount: 47,
        tokenCount: 12400,
        summary: 'Refactored authentication middleware to use JWT',
        messages: [
          { type: 'user', preview: 'Help me refactor the auth middleware', tokens: 45 },
          { type: 'thinking', preview: 'The user wants to refactor authentication...', tokens: 150 },
          { type: 'assistant', preview: "I'll analyze the current implementation...", tokens: 230 },
          { type: 'tool', preview: 'Read src/middleware/auth.ts', toolName: 'Read' },
          { type: 'tool', preview: 'Edit src/middleware/auth.ts', toolName: 'Edit' },
          { type: 'assistant', preview: "I've identified 3 areas for improvement...", tokens: 890 },
          { type: 'user', preview: 'Looks good, can you add tests?', tokens: 32 },
          { type: 'thinking', preview: 'Need to create unit tests for the new JWT logic...', tokens: 120 },
          { type: 'tool', preview: 'Write tests/auth.test.ts', toolName: 'Write' },
          { type: 'assistant', preview: "I've created comprehensive tests...", tokens: 450 },
        ]
      },
      {
        id: 'session-2',
        name: 'api-tests',
        workingDir: '~/projects/webapp/tests',
        timestamp: new Date(Date.now() - 3600000),
        messageCount: 23,
        tokenCount: 5200,
        summary: 'Created test suite for API endpoints',
        messages: [
          { type: 'user', preview: 'Create tests for the user API endpoints', tokens: 28 },
          { type: 'assistant', preview: "I'll create a comprehensive test suite...", tokens: 180 },
          { type: 'tool', preview: 'Glob tests/**/*.test.ts', toolName: 'Glob' },
          { type: 'tool', preview: 'Read src/api/users.ts', toolName: 'Read' },
          { type: 'assistant', preview: 'I found the existing patterns...', tokens: 320 },
        ]
      },
      {
        id: 'session-3',
        name: 'bug-investigation',
        workingDir: '~/projects/webapp/src',
        timestamp: new Date(Date.now() - 86400000),
        messageCount: 15,
        tokenCount: 3800,
        summary: 'Investigated and fixed cart calculation bug',
        messages: [
          { type: 'user', preview: 'The cart total is wrong when discounts apply', tokens: 42 },
          { type: 'thinking', preview: 'This sounds like a calculation order issue...', tokens: 200 },
          { type: 'tool', preview: 'Grep "discount" in src/cart/', toolName: 'Grep' },
          { type: 'assistant', preview: 'I found the issue in calculateTotal()...', tokens: 280 },
        ]
      },
      {
        id: 'session-4',
        name: 'docs-generation',
        workingDir: '~/projects/webapp/docs',
        timestamp: new Date(Date.now() - 172800000),
        messageCount: 31,
        tokenCount: 8900,
        summary: 'Generated API documentation from codebase',
        messages: [
          { type: 'user', preview: 'Generate API docs for all endpoints', tokens: 35 },
          { type: 'tool', preview: 'Glob src/api/**/*.ts', toolName: 'Glob' },
          { type: 'assistant', preview: 'I found 12 API files to document...', tokens: 420 },
          { type: 'tool', preview: 'Write docs/api-reference.md', toolName: 'Write' },
          { type: 'assistant', preview: 'Documentation complete with examples...', tokens: 650 },
        ]
      },
    ];


    // Status indicator component
    const StatusDot = ({ status, size = 'md' }) => {
      const sizeClasses = {
        sm: 'w-2 h-2',
        md: 'w-3 h-3',
        lg: 'w-4 h-4',
      };

      const colorClasses = {
        working: 'bg-state-working pulse-working pulse-neon',
        awaiting: 'bg-state-awaiting pulse-neon',
        idle: 'bg-state-idle',
        error: 'bg-state-error pulse-neon',
      };

      return (
        <span className={`inline-block rounded-full ${sizeClasses[size]} ${colorClasses[status]}`}
          style={{
            boxShadow: status === 'working' ? '0 0 10px #00ffff' :
                       status === 'awaiting' ? '0 0 10px #ffff00' :
                       status === 'error' ? '0 0 10px #ff0055' : 'none'
          }}
        />
      );
    };

    // Status badge with text
    const StatusBadge = ({ status }) => {
      const labels = {
        working: 'WORKING',
        awaiting: 'AWAITING',
        idle: 'IDLE',
        error: 'ERROR',
      };

      const styles = {
        working: { bg: 'bg-state-working/20', text: 'text-state-working', glow: '0 0 10px rgba(0, 255, 255, 0.5)' },
        awaiting: { bg: 'bg-state-awaiting/20', text: 'text-state-awaiting', glow: '0 0 10px rgba(255, 255, 0, 0.5)' },
        idle: { bg: 'bg-state-idle/20', text: 'text-state-idle', glow: 'none' },
        error: { bg: 'bg-state-error/20', text: 'text-state-error', glow: '0 0 10px rgba(255, 0, 85, 0.5)' },
      };

      const style = styles[status];

      return (
        <span
          className={`inline-flex items-center gap-1.5 px-2.5 py-1 clip-corner-sm text-xs font-bold tracking-wider border-2 ${style.bg} ${style.text}`}
          style={{
            borderColor: 'currentColor',
            boxShadow: style.glow,
          }}
        >
          <StatusDot status={status} size="sm" />
          {labels[status]}
        </span>
      );
    };

    // Pin icon (star)
    const PinIcon = ({ pinned, onClick, size = 'md' }) => {
      const sizeClasses = {
        sm: 'w-3.5 h-3.5',
        md: 'w-4 h-4',
        lg: 'w-5 h-5',
      };

      const handleClick = (e) => {
        e.stopPropagation();
        onClick();
      };

      return (
        <button
          onClick={handleClick}
          className={`
            p-1 rounded transition-all duration-150
            transform hover:scale-125 active:scale-90 jitter-hover
            ${pinned
              ? 'text-cyber-pink neon-text-pink'
              : 'text-gray-600 hover:text-cyber-cyan'}
          `}
          title={pinned ? 'Unpin instance' : 'Pin instance'}
        >
          <svg
            className={sizeClasses[size]}
            viewBox="0 0 24 24"
            fill={pinned ? 'currentColor' : 'none'}
            stroke="currentColor"
            strokeWidth="2"
          >
            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" />
          </svg>
        </button>
      );
    };

    // Editable name component for inline renaming
    const EditableName = ({
      instance, isEditing, editingName,
      onStartEdit, onNameChange, onConfirm, onCancel,
      className = ''
    }) => {
      const inputRef = React.useRef(null);

      useEffect(() => {
        if (isEditing && inputRef.current) {
          inputRef.current.focus();
          inputRef.current.select();
        }
      }, [isEditing]);

      const handleKeyDown = (e) => {
        if (e.key === 'Enter') { e.preventDefault(); onConfirm(); }
        if (e.key === 'Escape') { e.preventDefault(); onCancel(); }
      };

      if (isEditing) {
        return (
          <input
            ref={inputRef}
            type="text"
            value={editingName}
            onChange={(e) => onNameChange(e.target.value)}
            onKeyDown={handleKeyDown}
            onBlur={onConfirm}
            onClick={(e) => e.stopPropagation()}
            maxLength={32}
            className={`
              bg-cyber-bg-light border-2 border-cyber-pink clip-corner-sm px-2 py-0.5
              text-cyber-cyan font-bold outline-none neon-box-pink
              ${className}
            `}
            style={{ width: `${Math.max(editingName.length, 8)}ch` }}
          />
        );
      }

      return (
        <span
          className={`font-bold cursor-text hover:text-cyber-pink transition-colors glitch-hover ${className}`}
          onDoubleClick={(e) => { e.stopPropagation(); onStartEdit(); }}
          title="Double-click to rename"
        >
          {instance.name}
        </span>
      );
    };

    // Close button component
    const CloseButton = ({ onClick, className = '' }) => (
      <button
        onClick={(e) => { e.stopPropagation(); onClick(); }}
        className={`p-1 clip-corner-sm transition-all text-gray-600
                    hover:text-cyber-pink hover:bg-cyber-pink/20 hover-scale press-effect border border-transparent hover:border-cyber-pink ${className}`}
        aria-label="Close instance"
        style={{ boxShadow: 'none' }}
        onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 10px #ff00ff'}
        onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}
      >
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M18 6L6 18M6 6l12 12" />
        </svg>
      </button>
    );

    // Confirmation dialog for closing instances
    const ConfirmDialog = ({ isOpen, onConfirm, onCancel, instance }) => {
      if (!isOpen || !instance) return null;

      const getMessage = () => {
        if (instance.status === 'working') {
          return `"${instance.name}" is currently working. Are you sure you want to close it?`;
        }
        if (instance.status === 'awaiting') {
          return `"${instance.name}" is awaiting input. Are you sure you want to close it?`;
        }
        if (instance.status === 'error') {
          return `"${instance.name}" has an error. Are you sure you want to close it?`;
        }
        if (instance.pinned) {
          return `"${instance.name}" is pinned. Are you sure you want to close it?`;
        }
        return `Close "${instance.name}"?`;
      };

      return (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50" style={{ backdropFilter: 'blur(5px)' }}>
          <div className="gradient-border rounded-lg max-w-md shadow-2xl animate-in">
            <div className="bg-cyber-bg-light p-6 clip-corner">
              <h3 className="text-lg font-bold mb-2 neon-text-pink font-heading tracking-wider">CLOSE INSTANCE</h3>
              <p className="text-gray-400 mb-6">{getMessage()}</p>
              <div className="flex justify-end gap-3">
                <button
                  onClick={onCancel}
                  className="px-4 py-2 clip-corner-sm text-gray-400 hover:text-cyber-cyan hover:bg-cyber-bg-lighter transition-colors border border-gray-600 hover:border-cyber-cyan"
                  onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 10px rgba(0, 255, 255, 0.3)'}
                  onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}
                >
                  CANCEL
                </button>
                <button
                  onClick={onConfirm}
                  className="px-4 py-2 clip-corner-sm bg-state-error/20 text-state-error hover:bg-state-error/30 border-2 border-state-error transition-colors font-bold"
                  style={{ boxShadow: '0 0 10px rgba(255, 0, 85, 0.5)' }}
                  onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 20px rgba(255, 0, 85, 0.8)'}
                  onMouseLeave={(e) => e.currentTarget.style.boxShadow = '0 0 10px rgba(255, 0, 85, 0.5)'}
                >
                  CLOSE
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Empty state when no instances
    const EmptyState = () => (
      <div className="flex-1 flex items-center justify-center bg-cyber-bg-light data-stream">
        <div className="text-center text-gray-500">
          <svg className="w-16 h-16 mx-auto mb-4 text-cyber-purple" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"
            style={{ filter: 'drop-shadow(0 0 10px #9d4edd)' }}>
            <rect x="3" y="3" width="18" height="18" rx="2" />
            <path d="M12 8v8M8 12h8" />
          </svg>
          <h3 className="text-lg font-bold text-cyber-cyan mb-2 font-heading">NO INSTANCES</h3>
          <p className="text-sm">Click the + button to create a new instance</p>
        </div>
      </div>
    );

    // Custom tooltip component
    const Tooltip = ({ children, text, position = 'top' }) => (
      <div className="relative group/tooltip inline-flex">
        {children}
        <div className={`
          absolute z-50 px-2 py-1 text-xs font-bold
          bg-cyber-bg-lighter text-cyber-cyan clip-corner-sm border border-cyber-cyan
          opacity-0 group-hover/tooltip:opacity-100
          transition-opacity duration-200 delay-300
          pointer-events-none whitespace-nowrap
          ${position === 'top' ? 'bottom-full left-1/2 -translate-x-1/2 mb-2' : ''}
          ${position === 'bottom' ? 'top-full left-1/2 -translate-x-1/2 mt-2' : ''}
          ${position === 'left' ? 'right-full top-1/2 -translate-y-1/2 mr-2' : ''}
          ${position === 'right' ? 'left-full top-1/2 -translate-y-1/2 ml-2' : ''}
        `}
          style={{ boxShadow: '0 0 10px rgba(0, 255, 255, 0.5)' }}
        >
          {text}
        </div>
      </div>
    );

    // Expand button for focus mode
    const ExpandButton = ({ onClick, expanded = false, className = '' }) => (
      <button
        onClick={(e) => { e.stopPropagation(); onClick(); }}
        className={`p-1 clip-corner-sm transition-all text-gray-600
                    hover:text-cyber-purple hover:bg-cyber-purple/20 hover-scale press-effect border border-transparent hover:border-cyber-purple ${className}`}
        aria-label={expanded ? 'Collapse' : 'Expand'}
        title={expanded ? 'Collapse (Escape)' : 'Expand (Enter or double-click)'}
        onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 10px #9d4edd'}
        onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}
      >
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          {expanded ? (
            <>
              <path d="M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7" />
            </>
          ) : (
            <>
              <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
            </>
          )}
        </svg>
      </button>
    );

    // Thumbnail instance for focus mode sidebar
    const ThumbnailInstance = ({ instance, isActive, onClick }) => (
      <div
        onClick={onClick}
        className={`
          flex items-center gap-2 px-3 py-2 clip-corner-sm cursor-pointer
          transition-all hover:bg-cyber-bg-lighter border
          ${isActive ? 'bg-cyber-bg-lighter border-cyber-pink' : 'bg-cyber-bg-light border-gray-700 hover:border-cyber-cyan'}
        `}
        style={{
          boxShadow: isActive ? '0 0 10px rgba(255, 0, 255, 0.5)' : 'none'
        }}
        onMouseEnter={(e) => !isActive && (e.currentTarget.style.boxShadow = '0 0 10px rgba(0, 255, 255, 0.3)')}
        onMouseLeave={(e) => !isActive && (e.currentTarget.style.boxShadow = 'none')}
      >
        <StatusDot status={instance.status} size="sm" />
        <span className="text-sm font-medium truncate flex-1">{instance.name}</span>
      </div>
    );

    // Focus overlay backdrop
    const FocusOverlay = ({ onClick, children }) => (
      <div
        className="fixed inset-0 bg-black/80 z-40 flex"
        style={{ backdropFilter: 'blur(8px)' }}
        onClick={onClick}
      >
        <div onClick={(e) => e.stopPropagation()} className="flex flex-1">
          {children}
        </div>
      </div>
    );

    // Terminal preview component
    const TerminalPreview = ({ output, compact = false }) => (
      <div className={`bg-cyber-bg clip-corner-sm overflow-hidden border border-cyber-cyan/30 ${compact ? 'h-20' : 'h-32'}`}>
        <div className="p-3 terminal-text text-gray-400 overflow-hidden">
          {output.slice(compact ? -2 : -4).map((line, i) => (
            <div key={i} className="truncate">{line}</div>
          ))}
        </div>
      </div>
    );

    // Tab bar layout
    const TabBarLayout = ({ instances, activeId, onSelect, onTogglePin, onRequestClose, onDoubleClick, onExpand, editingInstanceId, editingName, onStartEditing, onEditingNameChange, onConfirmRename, onCancelEditing }) => (
      <div className="flex items-center gap-1 px-2 py-2 bg-cyber-bg-light border-b-2 border-cyber-pink overflow-x-auto data-stream"
        style={{ boxShadow: '0 2px 10px rgba(255, 0, 255, 0.3)' }}>
        {instances.map((instance, i) => (
          <div
            key={instance.id}
            onClick={() => onSelect(instance.id)}
            onDoubleClick={() => onDoubleClick(instance.id)}
            className={`
              group animate-in delay-${i + 1} instance-item
              flex items-center gap-2 px-3 py-2 clip-corner-sm text-sm font-bold
              transition-all whitespace-nowrap cursor-pointer border-2
              ${instance.isClosing ? 'animate-out' : ''}
              ${activeId === instance.id
                ? 'bg-cyber-bg-lighter text-cyber-pink border-cyber-pink active-glow'
                : 'text-gray-400 hover:text-cyber-cyan hover:bg-cyber-bg-lighter border-transparent hover:border-cyber-cyan'}
            `}
          >
            <StatusDot status={instance.status} />
            <EditableName
              instance={instance}
              isEditing={editingInstanceId === instance.id}
              editingName={editingName}
              onStartEdit={() => onStartEditing(instance.id, instance.name)}
              onNameChange={onEditingNameChange}
              onConfirm={() => onConfirmRename(instance.id)}
              onCancel={onCancelEditing}
            />
            <PinIcon
              pinned={instance.pinned}
              onClick={() => onTogglePin(instance.id)}
              size="sm"
            />
            <ExpandButton
              onClick={() => onExpand(instance.id)}
              className="opacity-0 group-hover:opacity-100"
            />
            <Tooltip text="Close instance" position="bottom">
              <CloseButton
                onClick={() => onRequestClose(instance)}
                className="opacity-0 group-hover:opacity-100 -mr-1"
              />
            </Tooltip>
          </div>
        ))}
        <Tooltip text="New instance" position="bottom">
          <button className="ml-2 p-2 text-gray-600 hover:text-cyber-cyan hover:bg-cyber-bg-lighter clip-corner-sm transition-colors border border-transparent hover:border-cyber-cyan jitter-hover"
            onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 10px rgba(0, 255, 255, 0.5)'}
            onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M12 5v14M5 12h14" />
            </svg>
          </button>
        </Tooltip>
      </div>
    );

    // Card/Grid layout
    const CardLayout = ({ instances, activeId, onSelect, onTogglePin, onRequestClose, onDoubleClick, onExpand, editingInstanceId, editingName, onStartEditing, onEditingNameChange, onConfirmRename, onCancelEditing }) => (
      <div className="grid grid-cols-2 lg:grid-cols-3 gap-4 p-4">
        {instances.map((instance, i) => (
          <div
            key={instance.id}
            onClick={() => onSelect(instance.id)}
            onDoubleClick={() => onDoubleClick(instance.id)}
            className={`
              group relative animate-in delay-${i + 1} instance-item hover-lift
              bg-cyber-bg-light clip-corner p-4 cursor-pointer
              transition-all hover:bg-cyber-bg-lighter border-2
              ${instance.isClosing ? 'animate-out' : ''}
              ${activeId === instance.id ? 'border-cyber-pink active-glow' : 'border-gray-700 hover:border-cyber-cyan'}
            `}
          >
            <div className="absolute top-3 right-3 flex items-center gap-1 opacity-0 group-hover:opacity-100">
              <ExpandButton onClick={() => onExpand(instance.id)} />
              <Tooltip text="Close instance" position="left">
                <CloseButton onClick={() => onRequestClose(instance)} />
              </Tooltip>
            </div>
            <div className="flex items-center justify-between mb-3 pr-12">
              <div className="flex items-center gap-2">
                <StatusDot status={instance.status} size="lg" />
                <EditableName
                  instance={instance}
                  isEditing={editingInstanceId === instance.id}
                  editingName={editingName}
                  onStartEdit={() => onStartEditing(instance.id, instance.name)}
                  onNameChange={onEditingNameChange}
                  onConfirm={() => onConfirmRename(instance.id)}
                  onCancel={onCancelEditing}
                />
              </div>
              <PinIcon
                pinned={instance.pinned}
                onClick={() => onTogglePin(instance.id)}
                size="md"
              />
            </div>
            <StatusBadge status={instance.status} />
            <div className="mt-3 text-xs text-gray-500 font-mono truncate">
              {instance.workingDir}
            </div>
            <div className="mt-3">
              <TerminalPreview output={instance.lastOutput} compact />
            </div>
          </div>
        ))}
        {/* Add new instance card */}
        <div className="bg-cyber-bg-light clip-corner p-4 border-2 border-dashed border-gray-700 flex items-center justify-center cursor-pointer hover:border-cyber-purple transition-colors min-h-[200px] jitter-hover"
          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 15px rgba(157, 78, 221, 0.5)'}
          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}>
          <div className="text-center text-gray-500">
            <svg className="w-8 h-8 mx-auto mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M12 5v14M5 12h14" />
            </svg>
            <span className="text-sm font-bold">NEW INSTANCE</span>
          </div>
        </div>
      </div>
    );

    // List layout
    const ListLayout = ({ instances, activeId, onSelect, onTogglePin, onRequestClose, onDoubleClick, onExpand, editingInstanceId, editingName, onStartEditing, onEditingNameChange, onConfirmRename, onCancelEditing }) => (
      <div className="divide-y-2 divide-gray-800">
        {instances.map((instance, i) => (
          <div
            key={instance.id}
            onClick={() => onSelect(instance.id)}
            onDoubleClick={() => onDoubleClick(instance.id)}
            className={`
              group animate-in delay-${i + 1} instance-item
              flex items-center gap-4 px-4 py-3 cursor-pointer
              transition-colors hover:bg-cyber-bg-lighter
              ${instance.isClosing ? 'animate-out' : ''}
              ${activeId === instance.id ? 'bg-cyber-bg-lighter border-l-4 border-cyber-pink' : 'border-l-4 border-transparent'}
            `}
            style={{
              boxShadow: activeId === instance.id ? 'inset 4px 0 10px rgba(255, 0, 255, 0.3)' : 'none'
            }}
          >
            <PinIcon
              pinned={instance.pinned}
              onClick={() => onTogglePin(instance.id)}
              size="md"
            />
            <StatusDot status={instance.status} size="lg" />
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2">
                <EditableName
                  instance={instance}
                  isEditing={editingInstanceId === instance.id}
                  editingName={editingName}
                  onStartEdit={() => onStartEditing(instance.id, instance.name)}
                  onNameChange={onEditingNameChange}
                  onConfirm={() => onConfirmRename(instance.id)}
                  onCancel={onCancelEditing}
                />
              </div>
              <div className="text-xs text-gray-500 font-mono truncate">
                {instance.workingDir}
              </div>
            </div>
            <StatusBadge status={instance.status} />
            <div className="text-xs text-gray-500 w-48 truncate terminal-text">
              {instance.lastOutput[instance.lastOutput.length - 1]}
            </div>
            <ExpandButton
              onClick={() => onExpand(instance.id)}
              className="opacity-0 group-hover:opacity-100"
            />
            <Tooltip text="Close instance" position="top">
              <CloseButton
                onClick={() => onRequestClose(instance)}
                className="opacity-0 group-hover:opacity-100"
              />
            </Tooltip>
          </div>
        ))}
      </div>
    );


    // Layout switcher
    const LayoutSwitcher = ({ layout, onChange }) => {
      const layouts = [
        { id: 'tabs', icon: 'âŠž', label: 'Tabs' },
        { id: 'cards', icon: 'âŠŸ', label: 'Cards' },
        { id: 'list', icon: 'â˜°', label: 'List' },
      ];

      return (
        <div className="flex items-center gap-1 bg-cyber-bg-light clip-corner-sm p-1 border border-gray-700">
          {layouts.map(l => (
            <button
              key={l.id}
              onClick={() => onChange(l.id)}
              className={`
                px-3 py-1.5 clip-corner-sm text-sm font-bold transition-all border
                ${layout === l.id
                  ? 'bg-cyber-bg-lighter text-cyber-pink border-cyber-pink'
                  : 'text-gray-500 hover:text-cyber-cyan border-transparent hover:border-cyber-cyan'}
              `}
              title={l.label}
              style={{
                boxShadow: layout === l.id ? '0 0 10px rgba(255, 0, 255, 0.5)' : 'none'
              }}
            >
              {l.icon}
            </button>
          ))}
        </div>
      );
    };

    // ============ HOME PAGE COMPONENTS ============

    // Getting Started Banner (dismissible onboarding)
    const GettingStartedBanner = ({ visible, onDismiss }) => {
      if (!visible) return null;

      const steps = [
        { num: 1, title: 'Create an instance', desc: 'Click + to start a new terminal' },
        { num: 2, title: 'Navigate to project', desc: 'cd into your project directory' },
        { num: 3, title: 'Start Claude Code', desc: "Run 'claude' to begin coding" },
        { num: 4, title: 'Manage from here', desc: 'Pin, rename, and switch instances' },
      ];

      return (
        <div className="gradient-border clip-corner mb-6 animate-in">
          <div className="bg-cyber-bg-light p-6">
            <div className="flex justify-between items-start mb-4">
              <h2 className="text-lg font-bold text-cyber-pink font-heading neon-text-pink">GETTING STARTED</h2>
              <button
                onClick={onDismiss}
                className="text-gray-500 hover:text-cyber-cyan transition-colors p-1"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M18 6L6 18M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
              {steps.map(step => (
                <div key={step.num} className="flex flex-col">
                  <div className="flex items-center gap-2 mb-1">
                    <span className="text-cyber-pink font-bold neon-text">{step.num}.</span>
                    <span className="font-bold text-cyber-cyan">{step.title}</span>
                  </div>
                  <p className="text-sm text-gray-400">{step.desc}</p>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // Stat Cards (instance counts by status)
    const StatCards = ({ instances }) => {
      const stats = [
        { label: 'TOTAL', value: instances.length, color: '#9d4edd' },
        { label: 'WORKING', value: instances.filter(i => i.status === 'working').length, color: '#00ffff' },
        { label: 'AWAITING', value: instances.filter(i => i.status === 'awaiting').length, color: '#ffff00' },
        { label: 'ERRORS', value: instances.filter(i => i.status === 'error').length, color: '#ff0055' },
      ];

      return (
        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          {stats.map((stat, i) => (
            <div
              key={stat.label}
              className={`animate-in delay-${i + 1} bg-cyber-bg-light clip-corner p-4 border-2 skew-right`}
              style={{
                borderColor: stat.color,
                boxShadow: `0 0 20px ${stat.color}40, inset 0 0 20px ${stat.color}20`
              }}
            >
              <div className="text-5xl font-extrabold tracking-tight font-heading neon-text" style={{ color: stat.color }}>
                {stat.value}
              </div>
              <div className="text-sm text-gray-400 mt-1 font-bold">{stat.label}</div>
            </div>
          ))}
        </div>
      );
    };

    // Quick Actions (buttons)
    const QuickActions = ({ onNewInstance, onViewAll }) => (
      <div className="flex gap-3 mb-6">
        <button
          onClick={onNewInstance}
          className="flex items-center gap-2 px-5 py-3 bg-cyber-pink text-black font-bold clip-corner transition-all hover-lift press-effect border-2 border-cyber-pink font-heading"
          style={{ boxShadow: '0 0 20px rgba(255, 0, 255, 0.6)' }}
          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 30px rgba(255, 0, 255, 1)'}
          onMouseLeave={(e) => e.currentTarget.style.boxShadow = '0 0 20px rgba(255, 0, 255, 0.6)'}
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3">
            <path d="M12 5v14M5 12h14" />
          </svg>
          NEW INSTANCE
        </button>
        <button
          onClick={onViewAll}
          className="flex items-center gap-2 px-5 py-3 bg-cyber-bg-light text-cyber-cyan font-bold clip-corner transition-all hover-lift press-effect border-2 border-cyber-cyan"
          style={{ boxShadow: '0 0 15px rgba(0, 255, 255, 0.4)' }}
          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 25px rgba(0, 255, 255, 0.8)'}
          onMouseLeave={(e) => e.currentTarget.style.boxShadow = '0 0 15px rgba(0, 255, 255, 0.4)'}
        >
          VIEW ALL
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3">
            <path d="M5 12h14M12 5l7 7-7 7" />
          </svg>
        </button>
      </div>
    );

    // Instance Row (shared by PinnedInstances and RecentInstances)
    const InstanceRow = ({ instance, onClick, showPin = false }) => (
      <div
        onClick={onClick}
        className="flex items-center gap-3 px-4 py-3 hover:bg-cyber-bg-lighter cursor-pointer transition-all hover-highlight border-l-2 border-transparent hover:border-cyber-cyan"
        onMouseEnter={(e) => e.currentTarget.style.boxShadow = 'inset 4px 0 10px rgba(0, 255, 255, 0.3)'}
        onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}
      >
        <StatusDot status={instance.status} />
        {showPin && <span className="text-cyber-pink neon-text">â˜…</span>}
        <span className="font-bold text-cyber-cyan flex-1">{instance.name}</span>
        <StatusBadge status={instance.status} />
        <span className="text-xs text-gray-500 font-mono hidden sm:block">{instance.workingDir}</span>
      </div>
    );

    // Pinned Instances section
    const PinnedInstances = ({ instances, onSelectInstance }) => {
      const pinned = instances.filter(i => i.pinned);
      if (pinned.length === 0) return null;

      return (
        <div className="mb-6">
          <h3 className="flex items-center gap-2 text-xs font-bold tracking-widest text-gray-500 mb-3 font-heading">
            <span className="text-cyber-pink neon-text-pink">â˜…</span> PINNED INSTANCES
          </h3>
          <div className="bg-cyber-bg-light clip-corner overflow-hidden divide-y-2 divide-gray-800 border-2 border-cyber-pink/50"
            style={{ boxShadow: '0 0 15px rgba(255, 0, 255, 0.3)' }}>
            {pinned.map(instance => (
              <InstanceRow
                key={instance.id}
                instance={instance}
                onClick={() => onSelectInstance(instance.id)}
                showPin
              />
            ))}
          </div>
        </div>
      );
    };

    // Recent Instances section
    const RecentInstances = ({ instances, onSelectInstance }) => {
      const recent = instances.filter(i => !i.pinned).slice(0, 5);
      if (recent.length === 0) return null;

      return (
        <div className="mb-6">
          <h3 className="text-xs font-bold tracking-widest text-gray-500 mb-3 font-heading">RECENT INSTANCES</h3>
          <div className="bg-cyber-bg-light clip-corner overflow-hidden divide-y-2 divide-gray-800 border border-gray-700">
            {recent.map(instance => (
              <InstanceRow
                key={instance.id}
                instance={instance}
                onClick={() => onSelectInstance(instance.id)}
              />
            ))}
          </div>
        </div>
      );
    };

    // Home Page container
    const HomePage = ({ instances, showWelcome, onDismissWelcome, onNewInstance, onViewAll, onSelectInstance }) => (
      <div className="flex-1 overflow-auto bg-cyber-bg-light p-6 data-stream">
        <div className="max-w-4xl mx-auto">
          <GettingStartedBanner visible={showWelcome} onDismiss={onDismissWelcome} />
          <StatCards instances={instances} />
          <QuickActions onNewInstance={onNewInstance} onViewAll={onViewAll} />
          <PinnedInstances instances={instances} onSelectInstance={onSelectInstance} />
          <RecentInstances instances={instances} onSelectInstance={onSelectInstance} />
        </div>
      </div>
    );

    // ============ END HOME PAGE COMPONENTS ============

    // ============ HISTORY VIEW COMPONENTS ============

    // Message item for transcript display
    const MessageItem = ({ message }) => {
      const typeStyles = {
        user: { icon: 'ðŸ‘¤', color: 'text-cyber-pink', label: 'USER' },
        assistant: { icon: 'ðŸ¤–', color: 'text-cyber-cyan', label: 'CLAUDE' },
        tool: { icon: 'ðŸ”§', color: 'text-gray-500', label: 'TOOL' },
        thinking: { icon: 'ðŸ’­', color: 'text-gray-600', label: 'THINKING' },
      };

      const style = typeStyles[message.type] || typeStyles.assistant;

      return (
        <div className="flex gap-3 py-2 hover:bg-cyber-bg-lighter clip-corner-sm px-2 transition-colors">
          <span className={`text-sm ${style.color}`}>{style.icon}</span>
          <div className="flex-1 min-w-0">
            <span className={`text-xs ${style.color} font-bold`}>
              {message.toolName || style.label}
            </span>
            <p className="text-sm text-gray-400 truncate">{message.preview}</p>
          </div>
          {message.tokens && (
            <span className="text-xs text-gray-600 whitespace-nowrap">{message.tokens} tok</span>
          )}
        </div>
      );
    };

    // Transcript view - list of messages
    const TranscriptView = ({ messages }) => (
      <div className="space-y-1 max-h-64 overflow-auto">
        {messages.map((message, i) => (
          <MessageItem key={i} message={message} />
        ))}
      </div>
    );

    // Chevron icon for expand/collapse
    const ChevronIcon = ({ expanded }) => (
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        className={`text-gray-500 transition-transform duration-200 ${expanded ? 'rotate-180' : ''}`}
      >
        <path d="M6 9l6 6 6-6" />
      </svg>
    );

    // Session card with expandable transcript
    const SessionCard = ({ session, isExpanded, onToggle }) => {
      const formatTime = (date) => {
        return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
      };

      const formatTokens = (count) => {
        if (count >= 1000) {
          return `${(count / 1000).toFixed(1)}k`;
        }
        return count;
      };

      return (
        <div className="bg-cyber-bg-light clip-corner overflow-hidden hover-lift border-2 border-gray-700 hover:border-cyber-purple transition-all"
          onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 0 15px rgba(157, 78, 221, 0.4)'}
          onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}>
          {/* Header - always visible */}
          <div
            className="flex items-center justify-between p-4 cursor-pointer hover:bg-cyber-bg-lighter transition-colors"
            onClick={onToggle}
          >
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-1">
                <span className="font-bold text-cyber-cyan">{session.name}</span>
                <span className="text-xs text-gray-500">{formatTime(session.timestamp)}</span>
              </div>
              <div className="text-xs text-gray-500 font-mono">
                {session.workingDir}
              </div>
              <div className="flex items-center gap-3 mt-1 text-xs text-gray-500">
                <span>{session.messageCount} messages</span>
                <span className="text-gray-700">â€¢</span>
                <span>{formatTokens(session.tokenCount)} tokens</span>
                <span className="text-gray-700">â€¢</span>
                <span className="truncate italic">"{session.summary}"</span>
              </div>
            </div>
            <ChevronIcon expanded={isExpanded} />
          </div>

          {/* Transcript - expandable */}
          {isExpanded && (
            <div className="border-t-2 border-gray-800 p-4 bg-cyber-bg/50">
              <TranscriptView messages={session.messages} />
            </div>
          )}
        </div>
      );
    };

    // Date group header for session grouping
    const DateGroup = ({ label, children }) => (
      <div className="mb-6">
        <h3 className="text-xs font-bold tracking-widest text-gray-500 mb-3 flex items-center gap-2 font-heading">
          <span className="w-4 h-px bg-cyber-purple" style={{ boxShadow: '0 0 5px #9d4edd' }} />
          {label}
          <span className="flex-1 h-px bg-cyber-purple" style={{ boxShadow: '0 0 5px #9d4edd' }} />
        </h3>
        <div className="space-y-3">
          {children}
        </div>
      </div>
    );

    // Search icon
    const SearchIcon = ({ className = '' }) => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
        <circle cx="11" cy="11" r="8" />
        <path d="M21 21l-4.35-4.35" />
      </svg>
    );

    // History View container
    const HistoryView = ({ sessions, expandedSessions, onToggleSession, searchQuery, onSearchChange }) => {
      // Group sessions by date
      const groupByDate = (sessions) => {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        const lastWeek = new Date(today);
        lastWeek.setDate(lastWeek.getDate() - 7);

        const groups = {
          today: [],
          yesterday: [],
          thisWeek: [],
          older: [],
        };

        sessions.forEach(session => {
          const sessionDate = new Date(session.timestamp);
          sessionDate.setHours(0, 0, 0, 0);

          if (sessionDate.getTime() === today.getTime()) {
            groups.today.push(session);
          } else if (sessionDate.getTime() === yesterday.getTime()) {
            groups.yesterday.push(session);
          } else if (sessionDate >= lastWeek) {
            groups.thisWeek.push(session);
          } else {
            groups.older.push(session);
          }
        });

        return groups;
      };

      // Filter sessions by search query
      const filteredSessions = searchQuery
        ? sessions.filter(s =>
            s.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
            s.summary.toLowerCase().includes(searchQuery.toLowerCase()) ||
            s.workingDir.toLowerCase().includes(searchQuery.toLowerCase())
          )
        : sessions;

      const groupedSessions = groupByDate(filteredSessions);

      return (
        <div className="flex-1 overflow-auto bg-cyber-bg-light p-6 data-stream">
          <div className="max-w-4xl mx-auto">
            {/* Header with search */}
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-bold text-cyber-pink font-heading neon-text-pink">SESSION HISTORY</h2>
              <div className="relative">
                <SearchIcon className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" />
                <input
                  type="text"
                  placeholder="SEARCH SESSIONS..."
                  value={searchQuery}
                  onChange={(e) => onSearchChange(e.target.value)}
                  className="w-64 bg-cyber-bg-light border-2 border-cyber-cyan clip-corner-sm px-4 py-2 pl-10 text-sm text-cyber-cyan placeholder-gray-600 focus:outline-none font-bold"
                  style={{ boxShadow: '0 0 10px rgba(0, 255, 255, 0.3)' }}
                  onFocus={(e) => e.currentTarget.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.6)'}
                  onBlur={(e) => e.currentTarget.style.boxShadow = '0 0 10px rgba(0, 255, 255, 0.3)'}
                />
              </div>
            </div>

            {/* Session groups */}
            {groupedSessions.today.length > 0 && (
              <DateGroup label="TODAY">
                {groupedSessions.today.map(session => (
                  <SessionCard
                    key={session.id}
                    session={session}
                    isExpanded={expandedSessions.has(session.id)}
                    onToggle={() => onToggleSession(session.id)}
                  />
                ))}
              </DateGroup>
            )}

            {groupedSessions.yesterday.length > 0 && (
              <DateGroup label="YESTERDAY">
                {groupedSessions.yesterday.map(session => (
                  <SessionCard
                    key={session.id}
                    session={session}
                    isExpanded={expandedSessions.has(session.id)}
                    onToggle={() => onToggleSession(session.id)}
                  />
                ))}
              </DateGroup>
            )}

            {groupedSessions.thisWeek.length > 0 && (
              <DateGroup label="THIS WEEK">
                {groupedSessions.thisWeek.map(session => (
                  <SessionCard
                    key={session.id}
                    session={session}
                    isExpanded={expandedSessions.has(session.id)}
                    onToggle={() => onToggleSession(session.id)}
                  />
                ))}
              </DateGroup>
            )}

            {groupedSessions.older.length > 0 && (
              <DateGroup label="OLDER">
                {groupedSessions.older.map(session => (
                  <SessionCard
                    key={session.id}
                    session={session}
                    isExpanded={expandedSessions.has(session.id)}
                    onToggle={() => onToggleSession(session.id)}
                  />
                ))}
              </DateGroup>
            )}

            {filteredSessions.length === 0 && (
              <div className="text-center py-12 text-gray-500">
                <svg className="w-12 h-12 mx-auto mb-3 opacity-50" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5">
                  <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p className="text-sm">
                  {searchQuery ? `NO SESSIONS FOUND FOR "${searchQuery}"` : 'NO SESSION HISTORY YET'}
                </p>
              </div>
            )}
          </div>
        </div>
      );
    };

    // ============ END HISTORY VIEW COMPONENTS ============

    // Main terminal view
    const TerminalView = ({ instance, editingInstanceId, editingName, onStartEditing, onEditingNameChange, onConfirmRename, onCancelEditing }) => (
      <div className="flex-1 bg-cyber-bg flex flex-col terminal-glow">
        <div className="flex items-center justify-between px-4 py-3 bg-cyber-bg-light border-b-2 border-cyber-cyan/50"
          style={{ boxShadow: '0 2px 10px rgba(0, 255, 255, 0.2)' }}>
          <div className="flex items-center gap-3">
            <StatusDot status={instance.status} size="lg" />
            <EditableName
              instance={instance}
              isEditing={editingInstanceId === instance.id}
              editingName={editingName}
              onStartEdit={() => onStartEditing(instance.id, instance.name)}
              onNameChange={onEditingNameChange}
              onConfirm={() => onConfirmRename(instance.id)}
              onCancel={onCancelEditing}
            />
            <StatusBadge status={instance.status} />
          </div>
          <div className="flex items-center gap-2 text-xs text-gray-500 font-mono">
            {instance.workingDir}
          </div>
        </div>
        <div className="flex-1 p-4 terminal-text text-gray-300 overflow-auto">
          {instance.lastOutput.map((line, i) => (
            <div key={i} className="py-0.5">{line}</div>
          ))}
          <div className="mt-4 text-gray-600">
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>
            [TERMINAL OUTPUT WOULD APPEAR HERE]<br/>
            THIS IS A MOCKUP PREVIEW OF THE TERMINAL<br/>
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          </div>
        </div>
      </div>
    );

    // Focused terminal view for focus mode (with collapse button)
    const FocusedTerminalView = ({ instance, onCollapse, editingInstanceId, editingName, onStartEditing, onEditingNameChange, onConfirmRename, onCancelEditing }) => (
      <div className="flex-1 bg-cyber-bg flex flex-col clip-corner overflow-hidden shadow-2xl border-4 border-cyber-pink active-glow focus-expand terminal-glow">
        <div className="flex items-center justify-between px-4 py-3 bg-cyber-bg-light border-b-2 border-cyber-cyan">
          <div className="flex items-center gap-3">
            <StatusDot status={instance.status} size="lg" />
            <EditableName
              instance={instance}
              isEditing={editingInstanceId === instance.id}
              editingName={editingName}
              onStartEdit={() => onStartEditing(instance.id, instance.name)}
              onNameChange={onEditingNameChange}
              onConfirm={() => onConfirmRename(instance.id)}
              onCancel={onCancelEditing}
              className="text-lg"
            />
            <StatusBadge status={instance.status} />
          </div>
          <div className="flex items-center gap-4">
            <span className="text-xs text-gray-500 font-mono">
              {instance.workingDir}
            </span>
            <ExpandButton onClick={onCollapse} expanded={true} />
          </div>
        </div>
        <div className="flex-1 p-4 terminal-text text-gray-300 overflow-auto">
          {instance.lastOutput.map((line, i) => (
            <div key={i} className="py-0.5">{line}</div>
          ))}
          <div className="mt-4 text-gray-600">
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>
            [TERMINAL OUTPUT WOULD APPEAR HERE]<br/>
            THIS IS A MOCKUP PREVIEW OF THE TERMINAL<br/>
            PRESS ESCAPE OR CLICK OUTSIDE TO EXIT FOCUS MODE<br/>
            â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          </div>
        </div>
      </div>
    );

    // Main App
    const App = () => {
      const [layout, setLayout] = useState('tabs');
      const [activeInstance, setActiveInstance] = useState('1');
      const [instances, setInstances] = useState(mockInstances);
      const [editingInstanceId, setEditingInstanceId] = useState(null);
      const [editingName, setEditingName] = useState('');
      const [focusedInstance, setFocusedInstance] = useState(null);

      // View state: 'instances' (default), 'home', or 'history'
      const [currentView, setCurrentView] = useState('instances');

      // History view state
      const [sessions] = useState(mockSessions);
      const [expandedSessions, setExpandedSessions] = useState(new Set());
      const [sessionSearch, setSessionSearch] = useState('');

      const toggleSessionExpanded = (sessionId) => {
        setExpandedSessions(prev => {
          const next = new Set(prev);
          if (next.has(sessionId)) {
            next.delete(sessionId);
          } else {
            next.add(sessionId);
          }
          return next;
        });
      };

      // Welcome banner visibility (localStorage backed)
      const [showWelcome, setShowWelcome] = useState(() => {
        if (typeof window !== 'undefined') {
          return localStorage.getItem('cc-welcome-dismissed') !== 'true';
        }
        return true;
      });

      const dismissWelcome = () => {
        setShowWelcome(false);
        localStorage.setItem('cc-welcome-dismissed', 'true');
      };

      // Keyboard handlers for focus mode
      useEffect(() => {
        const handleKeyDown = (e) => {
          // Don't handle keys when editing a name
          if (editingInstanceId) return;

          if (e.key === 'Escape' && focusedInstance) {
            setFocusedInstance(null);
          }
          if (e.key === 'Enter' && activeInstance && !focusedInstance) {
            setFocusedInstance(activeInstance);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [focusedInstance, activeInstance, editingInstanceId]);

      // Handle double-click to focus
      const handleDoubleClickInstance = (instanceId) => {
        if (focusedInstance === instanceId) {
          setFocusedInstance(null);
        } else {
          setFocusedInstance(instanceId);
        }
      };

      // Exit focus mode
      const exitFocusMode = () => {
        setFocusedInstance(null);
      };

      // Switch focus to another instance
      const switchFocus = (instanceId) => {
        setActiveInstance(instanceId);
        setFocusedInstance(instanceId);
      };

      // Validate instance name
      const validateName = (name) => {
        if (!name || name.length === 0) return false;
        if (name.length > 32) return false;
        return /^[a-zA-Z0-9_-]+$/.test(name);
      };

      // Start editing an instance name
      const startEditing = (instanceId, currentName) => {
        setEditingInstanceId(instanceId);
        setEditingName(currentName);
      };

      // Cancel editing
      const cancelEditing = () => {
        setEditingInstanceId(null);
        setEditingName('');
      };

      // Confirm rename
      const confirmRename = (instanceId) => {
        const trimmedName = editingName.trim();
        if (validateName(trimmedName)) {
          setInstances(prev => prev.map(inst =>
            inst.id === instanceId ? { ...inst, name: trimmedName } : inst
          ));
        }
        cancelEditing();
      };

      // Toggle pin state for an instance
      const togglePin = (instanceId) => {
        setInstances(prev => prev.map(instance =>
          instance.id === instanceId
            ? { ...instance, pinned: !instance.pinned }
            : instance
        ));
      };

      // Close instance state
      const [closeConfirmation, setCloseConfirmation] = useState(null);

      // Request to close an instance (may show confirmation)
      const requestClose = (instance) => {
        const needsConfirmation =
          instance.status === 'working' ||
          instance.status === 'awaiting' ||
          instance.status === 'error' ||
          instance.pinned;

        if (needsConfirmation) {
          setCloseConfirmation(instance);
        } else {
          handleCloseInstance(instance.id);
        }
      };

      // Handle closing an instance
      const handleCloseInstance = (instanceId) => {
        const instanceIndex = instances.findIndex(i => i.id === instanceId);
        const wasActive = activeInstance === instanceId;

        // Apply closing animation
        setInstances(prev => prev.map(i =>
          i.id === instanceId ? { ...i, isClosing: true } : i
        ));

        // After animation, remove and update selection
        setTimeout(() => {
          setInstances(prev => {
            const remaining = prev.filter(i => i.id !== instanceId);

            if (wasActive && remaining.length > 0) {
              const newActiveIndex = Math.max(0, instanceIndex - 1);
              setActiveInstance(remaining[Math.min(newActiveIndex, remaining.length - 1)].id);
            } else if (remaining.length === 0) {
              setActiveInstance(null);
            }

            return remaining;
          });
        }, 200);
      };

      // Confirm close from dialog
      const confirmClose = () => {
        if (closeConfirmation) {
          handleCloseInstance(closeConfirmation.id);
          setCloseConfirmation(null);
        }
      };

      // Cancel close dialog
      const cancelClose = () => {
        setCloseConfirmation(null);
      };

      // Sort instances with pinned first
      const sortedInstances = [...instances].sort((a, b) => {
        if (a.pinned && !b.pinned) return -1;
        if (!a.pinned && b.pinned) return 1;
        return 0;
      });

      const activeInst = instances.find(i => i.id === activeInstance) || instances[0];

      return (
        <div className="h-screen flex flex-col bg-cyber-atmosphere">
          {/* Header */}
          <header className="flex items-center justify-between px-4 py-4 bg-cyber-bg-light border-b-4 border-cyber-pink"
            style={{ boxShadow: '0 4px 20px rgba(255, 0, 255, 0.4)' }}>
            <div className="flex items-center gap-4">
              <h1
                className="text-2xl font-black tracking-tight text-cyber-pink cursor-pointer font-heading neon-text-pink glitch-hover skew-left"
                onClick={() => setCurrentView('home')}
                title="Go to Home"
              >
                <span className="text-cyber-cyan neon-text-cyan">CC</span> ORCHESTRATOR
              </h1>
              <div className="text-xs text-cyber-purple font-bold font-heading clip-corner-sm px-2 py-1 bg-cyber-purple/20 border border-cyber-purple"
                style={{ boxShadow: '0 0 10px rgba(157, 78, 221, 0.5)' }}>
                CYBERPUNK
              </div>
              <div className="text-xs text-gray-500 font-mono">
                {instances.length} instances
                {instances.filter(i => i.pinned).length > 0 && (
                  <span className="ml-2 text-cyber-pink neon-text">
                    ({instances.filter(i => i.pinned).length} pinned)
                  </span>
                )}
              </div>
            </div>
            <div className="flex items-center gap-3">
              {/* History button */}
              <Tooltip text="Session History" position="bottom">
                <button
                  onClick={() => setCurrentView(currentView === 'history' ? 'instances' : 'history')}
                  className={`
                    flex items-center gap-2 px-3 py-2 clip-corner-sm text-sm font-bold transition-all border-2
                    ${currentView === 'history'
                      ? 'bg-cyber-pink text-black border-cyber-pink'
                      : 'text-gray-500 hover:text-cyber-purple hover:bg-cyber-bg-lighter border-gray-700 hover:border-cyber-purple'}
                  `}
                  style={{
                    boxShadow: currentView === 'history' ? '0 0 15px rgba(255, 0, 255, 0.6)' : 'none'
                  }}
                  onMouseEnter={(e) => currentView !== 'history' && (e.currentTarget.style.boxShadow = '0 0 15px rgba(157, 78, 221, 0.5)')}
                  onMouseLeave={(e) => currentView !== 'history' && (e.currentTarget.style.boxShadow = 'none')}
                >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span className="hidden sm:inline">HISTORY</span>
                </button>
              </Tooltip>
              {currentView === 'instances' && (
                <LayoutSwitcher layout={layout} onChange={setLayout} />
              )}
            </div>
          </header>

          {/* Main content */}
          <div className="flex-1 flex overflow-hidden">
            <div className="flex-1 flex flex-col overflow-hidden">
              {currentView === 'history' ? (
                <HistoryView
                  sessions={sessions}
                  expandedSessions={expandedSessions}
                  onToggleSession={toggleSessionExpanded}
                  searchQuery={sessionSearch}
                  onSearchChange={setSessionSearch}
                />
              ) : currentView === 'home' ? (
                <HomePage
                  instances={instances}
                  showWelcome={showWelcome}
                  onDismissWelcome={dismissWelcome}
                  onNewInstance={() => {
                    // TODO: implement new instance creation
                    setCurrentView('instances');
                  }}
                  onViewAll={() => setCurrentView('instances')}
                  onSelectInstance={(id) => {
                    setActiveInstance(id);
                    setCurrentView('instances');
                  }}
                />
              ) : instances.length === 0 ? (
                <EmptyState />
              ) : (
                <>
                  {layout === 'tabs' && (
                    <>
                      <TabBarLayout
                        instances={sortedInstances}
                        activeId={activeInstance}
                        onSelect={setActiveInstance}
                        onTogglePin={togglePin}
                        onRequestClose={requestClose}
                        onDoubleClick={handleDoubleClickInstance}
                        onExpand={(id) => setFocusedInstance(id)}
                        editingInstanceId={editingInstanceId}
                        editingName={editingName}
                        onStartEditing={startEditing}
                        onEditingNameChange={setEditingName}
                        onConfirmRename={confirmRename}
                        onCancelEditing={cancelEditing}
                      />
                      {activeInst && (
                        <TerminalView
                          instance={activeInst}
                          editingInstanceId={editingInstanceId}
                          editingName={editingName}
                          onStartEditing={startEditing}
                          onEditingNameChange={setEditingName}
                          onConfirmRename={confirmRename}
                          onCancelEditing={cancelEditing}
                        />
                      )}
                    </>
                  )}
                  {layout === 'cards' && (
                    <div className="flex-1 overflow-auto bg-cyber-bg-light data-stream">
                      <CardLayout
                        instances={sortedInstances}
                        activeId={activeInstance}
                        onSelect={setActiveInstance}
                        onTogglePin={togglePin}
                        onRequestClose={requestClose}
                        onDoubleClick={handleDoubleClickInstance}
                        onExpand={(id) => setFocusedInstance(id)}
                        editingInstanceId={editingInstanceId}
                        editingName={editingName}
                        onStartEditing={startEditing}
                        onEditingNameChange={setEditingName}
                        onConfirmRename={confirmRename}
                        onCancelEditing={cancelEditing}
                      />
                    </div>
                  )}
                  {layout === 'list' && (
                    <div className="flex-1 overflow-auto bg-cyber-bg-light data-stream">
                      <ListLayout
                        instances={sortedInstances}
                        activeId={activeInstance}
                        onSelect={setActiveInstance}
                        onTogglePin={togglePin}
                        onRequestClose={requestClose}
                        onDoubleClick={handleDoubleClickInstance}
                        onExpand={(id) => setFocusedInstance(id)}
                        editingInstanceId={editingInstanceId}
                        editingName={editingName}
                        onStartEditing={startEditing}
                        onEditingNameChange={setEditingName}
                        onConfirmRename={confirmRename}
                        onCancelEditing={cancelEditing}
                      />
                      {activeInst && (
                        <div className="border-t-2 border-cyber-cyan">
                          <TerminalView
                            instance={activeInst}
                            editingInstanceId={editingInstanceId}
                            editingName={editingName}
                            onStartEditing={startEditing}
                            onEditingNameChange={setEditingName}
                            onConfirmRename={confirmRename}
                            onCancelEditing={cancelEditing}
                          />
                        </div>
                      )}
                    </div>
                  )}
                </>
              )}
            </div>
          </div>

          {/* Focus Mode Overlay */}
          {focusedInstance && instances.find(i => i.id === focusedInstance) && (
            <FocusOverlay onClick={exitFocusMode}>
              {/* Focused Terminal (main area) */}
              <div className="flex-1 p-6 flex">
                <FocusedTerminalView
                  instance={instances.find(i => i.id === focusedInstance)}
                  onCollapse={exitFocusMode}
                  editingInstanceId={editingInstanceId}
                  editingName={editingName}
                  onStartEditing={startEditing}
                  onEditingNameChange={setEditingName}
                  onConfirmRename={confirmRename}
                  onCancelEditing={cancelEditing}
                />
              </div>

              {/* Thumbnail Sidebar */}
              {instances.length > 1 && (
                <div className="w-64 bg-cyber-bg-light border-l-4 border-cyber-cyan p-4 flex flex-col gap-2 overflow-auto"
                  style={{ boxShadow: 'inset 4px 0 20px rgba(0, 255, 255, 0.2)' }}>
                  <div className="text-xs text-gray-500 font-bold mb-2 font-heading">OTHER INSTANCES</div>
                  {sortedInstances
                    .filter(i => i.id !== focusedInstance)
                    .map(instance => (
                      <ThumbnailInstance
                        key={instance.id}
                        instance={instance}
                        isActive={instance.id === activeInstance}
                        onClick={() => switchFocus(instance.id)}
                      />
                    ))}
                </div>
              )}
            </FocusOverlay>
          )}

          {/* Confirmation Dialog */}
          <ConfirmDialog
            isOpen={closeConfirmation !== null}
            instance={closeConfirmation}
            onConfirm={confirmClose}
            onCancel={cancelClose}
          />
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
